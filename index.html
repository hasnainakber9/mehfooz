<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mehfooz | Clarity in the Digital Crossroads</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lenis@1.0.45/dist/lenis.min.js"></script>

    <style>
        /* ---
        SOPHISTICATED THEME (NAVY/TEAL/GOLD)
        ---
        */
        :root {
            --dark-bg: #0F172A; /* Deep Navy */
            --light-text: #E2E8F0;
            --medium-text: #94A3B8;
            --card-bg: #1E293B; /* Slightly lighter navy */
            --border-color: #334155;
            --gold: #F4B860;
            --teal: #00A896;
            --danger: #ef4444;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Caveat:wght@700&display=swap');

        html.lenis { height: auto; }
        .lenis.lenis-smooth { scroll-behavior: auto; }

        body {
            background-color: var(--dark-bg);
            color: var(--light-text);
            font-family: 'Inter', sans-serif; /* Modern, clean font */
            overflow-x: hidden;
            cursor: none;
        }

        .font-script {
            font-family: 'Caveat', cursive;
        }
        
        /* ---
        INTIMATE CURSOR
        ---
        */
        #cursor-light {
            position: fixed;
            width: 800px; height: 800px; /* Larger, more ambient light */
            border-radius: 50%;
            left: 0; top: 0;
            pointer-events: none;
            background: radial-gradient(circle, rgba(244, 184, 96, 0.07) 0%, transparent 60%);
            transform: translate(-50%, -50%);
            z-index: 9999;
            transition: transform 0.3s ease-out;
        }
        #cursor-dot {
            position: fixed;
            width: 6px; height: 6px;
            background-color: var(--gold);
            border-radius: 50%;
            left: 0; top: 0;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 10000;
        }
        
        #bg-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100vh;
            z-index: -1;
        }

        .content-section {
            position: relative;
            z-index: 1;
            padding: 20vh 0;
        }
        
        /* ---
        NEW GAME STYLES
        ---
        */
        #game-screen {
            background-color: var(--dark-bg);
        }
        .game-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: none;
        }
        .game-statement-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            min-height: 10rem;
        }
        .game-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        .game-btn:hover {
            transform: translateY(-5px);
            background-color: var(--teal);
            border-color: var(--teal);
        }
        .game-btn.gold:hover {
            background-color: var(--gold);
            border-color: var(--gold);
            color: var(--dark-bg);
        }
        #enter-site-btn {
            transition: all 0.3s ease;
        }
        #enter-site-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        /* Animate-in styles */
        .reveal-up { opacity: 0; transform: translateY(40px); }

        /* ---
        CHAT & FORM STYLES (SOPHISTICATED)
        ---
        */
        .chat-bubble { max-width: 75%; padding: 12px 18px; border-radius: 18px; line-height: 1.5; }
        .user-bubble { background-color: var(--teal); color: white; border-bottom-right-radius: 4px; align-self: flex-end; }
        .bot-bubble { background-color: var(--card-bg); color: var(--light-text); border-bottom-left-radius: 4px; align-self: flex-start; }

        .chat-prompt-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--medium-text);
            transition: all 0.3s ease;
        }
        .chat-prompt-btn:hover {
            background-color: var(--teal);
            border-color: var(--teal);
            color: white;
        }
        
        .form-input {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--light-text);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--teal);
            box-shadow: 0 0 0 3px rgba(0, 168, 150, 0.3);
        }
        
        .btn-teal {
             background-color: var(--teal);
             color: white;
             transition: all 0.3s ease;
        }
        .btn-teal:hover {
            background-color: var(--gold);
            color: var(--dark-bg);
            transform: scale(1.05);
        }

        /* ---
        FRIENDLY NAVIGATION
        ---
        */
        #friendly-nav {
            transform: translateY(200%);
            transition: transform 0.8s cubic-bezier(0.19, 1, 0.22, 1);
        }
        #friendly-nav.visible {
            transform: translateY(0);
        }
        .nav-link.active {
            color: var(--gold);
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--gold);
            transform: scaleX(0);
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .nav-link.active::after,
        .nav-link:hover::after {
            transform: scaleX(1);
        }

        .value-icon {
            stroke-width: 1;
            transition: all 0.4s ease;
        }
        .value-container:hover .value-icon {
            transform: scale(1.1);
            stroke: var(--gold);
        }
    </style>
</head>
<body class="antialiased">

    <div id="cursor-light"></div>
    <div id="cursor-dot"></div>
    <canvas id="bg-canvas"></canvas>

    <div id="game-screen" class="fixed inset-0 z-[101] flex items-center justify-center p-4 transition-opacity duration-500">
        <div class="text-center w-full max-w-2xl">
            
             <div id="game-intro">
                 <h2 class="font-script text-gold text-4xl md:text-6xl mb-2">A Quiet Moment</h2>
                 <p class="text-medium-text text-lg mb-8">The digital world is full of voices. Before we begin, let's take a moment to listen to our own intuition.</p>
                 <button id="game-start-btn" class="game-btn gold bg-gold text-dark-bg font-bold py-3 px-8 rounded-lg text-xl hover:scale-105">Begin</button>
             </div>
             
             <div id="game-main" class="hidden">
                <p id="game-prompt" class="text-lg text-teal mb-4"></p>
                <div id="game-statement" class="game-statement-card rounded-lg p-6 md:p-8 text-xl md:text-2xl flex items-center justify-center mb-6">
                    </div>
                <div id="game-buttons" class="flex flex-col md:flex-row gap-4 justify-center">
                    <button id="game-btn-1" class="game-btn text-lg font-semibold py-3 px-6 rounded-lg"></button>
                    <button id="game-btn-2" class="game-btn text-lg font-semibold py-3 px-6 rounded-lg"></button>
                </div>
                <p id="game-feedback" class="mt-6 text-lg max-w-2xl mx-auto min-h-[4rem] text-medium-text"></p>
             </div>

             <div id="game-end" class="hidden">
                 <h3 class="font-script text-teal text-4xl mb-4">A Thoughtful Heart</h3>
                 <p class="text-xl text-medium-text mb-8">The journey to clarity isn't about knowing all the answers, but about being willing to ask the right questions. You are ready.</p>
                 <button id="enter-site-btn" class="bg-gold text-dark-bg font-bold py-3 px-8 rounded-lg text-xl">Enter Mehfooz</button>
             </div>
        </div>
    </div>
    
    <main id="main-content" class="opacity-0">
        <header class="fixed top-0 left-0 w-full z-50">
            <nav class="container mx-auto flex justify-between items-center p-6 md:p-8">
                <a href="#home" class="font-script text-3xl text-gold">Mehfooz</a>
            </nav>
        </header>

        <section id="home" class="content-section h-screen flex items-center justify-center text-center">
            <div class="px-4">
                <h1 class="font-script text-gold text-5xl md:text-8xl mb-4 reveal-up">Clarity in the Digital Crossroads.</h1>
                <p class="text-xl md:text-2xl text-light-text leading-relaxed max-w-4xl reveal-up">
                    For the people of Gilgit Baltistan, a safe space to find clarity in a connected world.
                </p>
                 <div class="absolute bottom-16 left-1/2 -translate-x-1/2">
                    <a href="#journal" class="font-script text-medium-text animate-pulse">Scroll to Discover</a>
                </div>
            </div>
        </section>

        <section id="journal" class="content-section py-20 md:py-40">
             <div class="container mx-auto px-6 max-w-4xl">
                 <div class="flex flex-col md:flex-row gap-12 items-center">
                     <div class="w-full md:w-1/2">
                         <div class="overflow-hidden rounded-lg shadow-2xl shadow-black/50">
                            <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?q=80&w=2070&auto-format=fit=crop" alt="A diverse group of people from Skardu warmly interacting and learning together" class="w-full h-full object-cover">
                         </div>
                     </div>
                     <div class="w-full md:w-1/2">
                         <h2 class="font-script text-gold text-5xl md:text-6xl mb-4 reveal-up">From Our Journal</h2>
                         <p class="text-lg text-medium-text leading-relaxed mb-6 reveal-up">Mehfooz began not with a line of code, but with a conversation. In a small <strong>Skardu</strong> teahouse, over cups of warm chai, we listened. We heard stories of connection and confusion, of hope and fear in a new digital world where progress was meeting peril.</p>
                         <p class="text-lg text-medium-text leading-relaxed reveal-up">We learned that the need wasn't for more technology, but for more understanding. For a bridge between timeless wisdom and modern tools. Mehfooz is our promise to help build that bridge, together.</p>
                     </div>
                 </div>
             </div>
        </section>

        <section id="approach" class="content-section py-20 md:py-40">
            <div class="container mx-auto px-6 max-w-5xl">
                <div class="text-center reveal-up mb-20">
                    <h2 class="font-script text-gold text-5xl md:text-6xl mb-4">Our Approach is Simple</h2>
                </div>
                <div class="grid md:grid-cols-3 gap-12 text-center">
                    <div class="reveal-up">
                        <h3 class="font-script text-teal text-4xl mb-3">Listen First</h3>
                        <p class="text-medium-text leading-relaxed">We don't just provide information; we build on existing foundations of trust. Through a groundbreaking model, we collaborate with local religious leaders (Ulema) who serve as trusted digital literacy ambassadors.</p>
                    </div>
                    <div class="reveal-up">
                        <h3 class="font-script text-teal text-4xl mb-3">Guide Gently</h3>
                        <p class="text-medium-text leading-relaxed">Harnessing the power of AI, our tool, MehfoozBot, offers personal, patient help. It adapts to each user's language and learning style, making technology feel like a friend.</p>
                    </div>
                     <div class="reveal-up">
                        <h3 class="font-script text-teal text-4xl mb-3">Grow Together</h3>
                        <p class="text-medium-text leading-relaxed">Through short, localized mini-courses and a unique feedback ecosystem with local college students, we ensure our knowledge is always relevant, effective, and co-created with the community.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="community" class="content-section py-20 md:py-40">
            <div class="container mx-auto px-6 max-w-4xl">
                 <div class="text-center reveal-up">
                    <h2 class="font-script text-gold text-5xl md:text-6xl mb-4">The Heart of Our Community</h2>
                 </div>
                 <div class="mt-16 reveal-up">
                     <h3 class="font-script text-teal text-4xl mb-6 text-center">Voices from the Valley</h3>
                     <div class="space-y-8">
                         <blockquote class="border-l-4 border-gold pl-6 italic text-lg text-medium-text">"For the first time, I felt I could ask a 'silly' question about my phone without feeling embarrassed. MehfoozBot helped me understand."<cite class="block not-italic mt-2 text-light-text">- A student from Gilgit</cite></blockquote>
                         <blockquote class="border-l-4 border-gold pl-6 italic text-lg text-medium-text text-right">"They didn’t come to teach; they came to learn with us. That is why we trust them."<cite class="block not-italic mt-2 text-light-text">- An elder from <strong>Skardu</strong></cite></blockquote>
                     </div>
                 </div>
            </div>
        </section>
        
        <section id="vision" class="content-section py-20 md:py-40">
              <div class="container mx-auto px-6 max-w-4xl text-center">
                  <div class="reveal-up">
                      <h2 class="font-script text-gold text-5xl md:text-6xl mb-4">Our Five-Year Vision</h2>
                      <p class="text-xl text-medium-text max-w-3xl mx-auto">To scale our impact together, offering an opportunity for partners to co-create a digitally resilient future.</p>
                  </div>
                  <div class="mt-16 grid md:grid-cols-2 gap-x-12 gap-y-16 text-left">
                      <div class="reveal-up">
                          <p class="font-script text-teal text-7xl" id="user-counter">0</p>
                          <h3 class="text-2xl mt-2">Empowered Users Across Pakistan</h3>
                          <p class="text-medium-text mt-2">Leveraging our established educational networks and community structures for organic, sustainable growth.</p>
                      </div>
                      <div class="reveal-up">
                           <p class="font-script text-teal text-7xl">3+</p>
                          <h3 class="text-2xl mt-2">Platform Evolutions</h3>
                          <p class="text-medium-text mt-2">Introducing AI-driven learning paths, enhanced offline capabilities for remote areas, and expanded indigenous language support.</p>
                      </div>
                       <div class="reveal-up">
                           <h3 class="font-script text-teal text-5xl mb-3">Deepened Integration</h3>
                           <p class="text-medium-text mt-2">Strengthening our partnerships with educational institutions, community figures, and policymakers to ensure lasting adoption and impact.</p>
                      </div>
                      <div class="reveal-up">
                           <h3 class="font-script text-teal text-5xl mb-3">Become a Partner</h3>
                           <p class="text-medium-text mt-2">We are seeking partners for strategic guidance, technical support, funding, and operational efficiency to help us achieve this vision.</p>
                      </div>
                  </div>
              </div>
        </section>

         <section id="values" class="content-section py-20 md:py-40">
             <div class="container mx-auto px-6 max-w-5xl">
                  <div class="text-center reveal-up mb-20">
                     <h2 class="font-script text-gold text-5xl md:text-6xl mb-4">Our Guiding Principles</h2>
                  </div>
                 <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-12 text-center">
                     <div class="reveal-up value-container">
                         <svg class="w-16 h-16 mx-auto text-medium-text value-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a3.004 3.004 0 015.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                         <h3 class="text-2xl mt-4 font-script text-teal">Collaboration</h3>
                         <p class="text-medium-text mt-2">We build partnerships with local leaders, researchers, and community members to create a holistic approach.</p>
                     </div>
                      <div class="reveal-up value-container">
                         <svg class="w-16 h-16 mx-auto text-medium-text value-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                         <h3 class="text-2xl mt-4 font-script text-teal">Integrity</h3>
                         <p class="text-medium-text mt-2">We uphold the highest standards of accuracy, ensuring users receive trustworthy information.</p>
                     </div>
                      <div class="reveal-up value-container">
                         <svg class="w-16 h-16 mx-auto text-medium-text value-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                         <h3 class="text-2xl mt-4 font-script text-teal">Inclusivity</h3>
                         <p class="text-medium-text mt-2">We embrace diversity by providing resources in multiple languages, ensuring everyone has access.</p>
                     </div>
                      <div class="reveal-up value-container">
                         <svg class="w-16 h-16 mx-auto text-medium-text value-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                         <h3 class="text-2xl mt-4 font-script text-teal">Innovation</h3>
                         <p class="text-medium-text mt-2">We leverage cutting-edge technologies like AI to continuously enhance our educational offerings.</p>
                     </div>
                 </div>
             </div>
          </section>

        <section id="connect" class="content-section py-20 md:py-40">
              <div class="container mx-auto px-6 space-y-24">
                   <div class="text-center max-w-3xl mx-auto reveal-up">
                     <h2 class="font-script text-gold text-5xl md:text-6xl mb-4">Become a Part of the Solution</h2>
                     <p class="text-xl text-medium-text">Whether you are a community leader, a potential partner, or a researcher, there is a role for you. Let's connect.</p>
                   </div>
                   <div class="max-w-2xl mx-auto reveal-up">
                     <h3 class="font-script text-teal text-4xl mb-6 text-center">Chat with MehfoozBot</h3>
                     <div id="chat-log" class="bg-black/20 rounded-t-lg shadow-inner h-[50vh] flex flex-col gap-4 p-4 overflow-y-auto"></div>
                     <div class="bg-black/20 rounded-b-lg p-4">
                         <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3" id="prompt-buttons">
                            </div>
                         <form id="chat-form" class="flex gap-3">
                             <input type="text" id="chat-input" placeholder="Ask a friendly question..." class="form-input flex-1 border-medium-text/30 rounded-full py-3 px-5 focus:ring-2 focus:ring-teal">
                             <button type="submit" class="btn-teal rounded-full px-5 py-3 font-semibold">Send</button>
                         </form>
                     </div>
                   </div>
                   <div class="max-w-xl mx-auto reveal-up">
                     <h3 class="font-script text-teal text-4xl mb-6 text-center">Send a Personal Message</h3>
                     <form id="contact-form" class="space-y-6 text-left">
                           <div>
                             <label for="name" class="block mb-2 font-medium text-medium-text">Your Name</label>
                             <input type="text" id="name" required class="form-input w-full border-medium-text/30 rounded-lg p-3">
                           </div>
                           <div>
                             <label for="email" class="block mb-2 font-medium text-medium-text">Your Email</label>
                             <input type="email" id="email" required class="form-input w-full border-medium-text/30 rounded-lg p-3">
                           </div>
                            <div>
                                <label for="interest" class="block mb-2 font-medium text-medium-text">I am a...</label>
                                <select id="interest" class="form-input w-full border-medium-text/30 rounded-lg p-3 appearance-none">
                                    <option>Community Member</option>
                                    <option>Potential Partner / Investor</option>
                                    <option>Researcher / Institution</option>
                                    <option>Student</option>
                                </select>
                            </div>
                           <div>
                             <label for="message" class="block mb-2 font-medium text-medium-text">Your Message</label>
                             <textarea id="message" rows="5" required class="form-input w-full border-medium-text/30 rounded-lg p-3"></textarea>
                           </div>
                         <button type="submit" class="w-full btn-teal font-semibold py-4 px-6 rounded-lg">Send with heart</button>
                     </form>
                      <div id="form-success" class="hidden text-center border border-teal rounded-lg p-8 mt-6">
                         <p class="font-script text-teal text-3xl mb-2">Thank You!</p>
                         <p class="text-medium-text">Your message has been received. We'll be in touch soon.</p>
                      </div>
                   </div>
              </div>
        </section>

        <nav id="friendly-nav" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 bg-black/30 backdrop-blur-md rounded-full px-6 py-3 flex gap-6 text-lg text-medium-text">
            <a href="#home" class="nav-link relative hover:text-light-text transition-colors active">Home</a>
            <a href="#journal" class="nav-link relative hover:text-light-text transition-colors">Journal</a>
            <a href="#approach" class="nav-link relative hover:text-light-text transition-colors">Approach</a>
            <a href="#community" class="nav-link relative hover:text-light-text transition-colors">Community</a>
            <a href="#connect" class="nav-link relative hover:text-light-text transition-colors">Connect</a>
        </nav>

    </main>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        gsap.registerPlugin(ScrollTrigger);
        
        const mainContent = document.getElementById('main-content');
        const cursorLight = document.getElementById('cursor-light');
        const friendlyNav = document.getElementById('friendly-nav');
        
        let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
        gsap.ticker.add(() => { gsap.to(cursorLight, { duration: 0.5, x: mouse.x, y: mouse.y, ease: 'power2.out' }); });

        // --- SMOOTH SCROLL ---
        const lenis = new Lenis();
        function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
        }
        requestAnimationFrame(raf);
        
        // --- *** NAVIGATION FIX *** ---
        // This is moved outside of any other function to run on load.
        // It now correctly handles ALL anchor links, including the header.
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                lenis.scrollTo(this.getAttribute('href'));
            });
        });

        // --- "TRUST & DOUBT" GAME ---
        const gameScreen = document.getElementById('game-screen');
        const gameIntro = document.getElementById('game-intro');
        const gameMain = document.getElementById('game-main');
        const gameEnd = document.getElementById('game-end');
        const gameStartBtn = document.getElementById('game-start-btn');
        const gamePromptEl = document.getElementById('game-prompt');
        const gameStatementEl = document.getElementById('game-statement');
        const gameBtn1 = document.getElementById('game-btn-1');
        const gameBtn2 = document.getElementById('game-btn-2');
        const gameFeedbackEl = document.getElementById('game-feedback');
        
        const gameData = [
            {
                prompt: "A new message appears on your phone:",
                statement: "URGENT: Your bank account is compromised! Click this link *immediately* to secure it and verify your identity.",
                buttons: ["Trust", "Doubt"],
                feedback: [
                    "A feeling of urgency. This is often a trap. It's wise to pause.",
                    "You paused. That's the first step to clarity. Urgency is often a trap."
                ]
            },
            {
                prompt: "A relative shares an article on social media:",
                statement: "This simple home remedy cures all illnesses! Doctors are hiding it from you!",
                buttons: ["Share", "Question"],
                feedback: [
                    "It's tempting to help, but extraordinary claims without proof can be harmful.",
                    "You questioned it. That's the heart of critical thinking. Claims need evidence."
                ]
            }
        ];
        let gameStep = 0;

        function loadGameStep(stepIndex) {
            const step = gameData[stepIndex];
            
            gsap.to([gamePromptEl, gameStatementEl, gameButtons], {opacity: 0, y: 10, duration: 0.3, onComplete: () => {
                gamePromptEl.textContent = step.prompt;
                gameStatementEl.textContent = step.statement;
                gameBtn1.textContent = step.buttons[0];
                gameBtn2.textContent = step.buttons[1];
                gameFeedbackEl.textContent = '';
                
                gameBtn1.onclick = () => handleChoice(0);
                gameBtn2.onclick = () => handleChoice(1);
                
                gsap.to([gamePromptEl, gameStatementEl, gameButtons], {opacity: 1, y: 0, duration: 0.5, stagger: 0.1});
            }});
        }
        
        function handleChoice(choiceIndex) {
            const feedback = gameData[gameStep].feedback[choiceIndex];
            gameFeedbackEl.textContent = feedback;
            gsap.fromTo(gameFeedbackEl, {opacity: 0, y: 10}, {opacity: 1, y: 0, duration: 0.5});
            
            gameBtn1.disabled = true;
            gameBtn2.disabled = true;
            gsap.to([gameBtn1, gameBtn2], {opacity: 0.5, duration: 0.3});

            setTimeout(() => {
                gameStep++;
                if (gameStep < gameData.length) {
                    loadGameStep(gameStep);
                    gameBtn1.disabled = false;
                    gameBtn2.disabled = false;
                    gsap.to([gameBtn1, gameBtn2], {opacity: 1, duration: 0.3});
                } else {
                    showGameEnd();
                }
            }, 3500);
        }

        function showGameEnd() {
            gsap.to(gameMain, { opacity: 0, duration: 0.5, onComplete: () => {
                gameMain.style.display = 'none';
                gameEnd.classList.remove('hidden');
                gsap.from(gameEnd, {opacity: 0, y: 20, duration: 1});
            }});
        }

        gameStartBtn.addEventListener('click', () => {
            gsap.to(gameIntro, { opacity: 0, duration: 0.5, onComplete: () => {
                gameIntro.style.display = 'none';
                gameMain.classList.remove('hidden');
                gsap.from(gameMain, {opacity: 0, duration: 0.5});
                loadGameStep(0);
            }});
        });

        document.getElementById('enter-site-btn').addEventListener('click', () => {
             gsap.to(gameScreen, { opacity: 0, duration: 1, onComplete: () => {
                 gameScreen.style.display = 'none';
                 gsap.to(mainContent, { opacity: 1, duration: 1 });
                 initAnimations(); // Run main site animations
             }});
        });
        
        // --- THREE.JS BACKGROUND ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

        const particleCount = 7000;
        const positions = new Float32Array(particleCount * 3);
        const colors = new Float32Array(particleCount * 3);
        const colorGold = new THREE.Color(0xF4B860); // Updated Gold
        const colorTeal = new THREE.Color(0x00A896); // Updated Teal

        for(let i = 0; i < particleCount; i++) {
            const i3 = i * 3;
            positions[i3] = (Math.random() - 0.5) * 25;
            positions[i3 + 1] = (Math.random() - 0.5) * 25;
            positions[i3 + 2] = (Math.random() - 0.5) * 25;
            
            const mixedColor = Math.random() > 0.7 ? colorGold.clone() : colorTeal.clone().lerp(colorGold, Math.random() * 0.3);
            colors[i3] = mixedColor.r;
            colors[i3 + 1] = mixedColor.g;
            colors[i3 + 2] = mixedColor.b;
        }
        const particlesGeometry = new THREE.BufferGeometry();
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        
        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.025,
            sizeAttenuation: true,
            transparent: true,
            opacity: 0.6,
            vertexColors: true
        });
        const particles = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particles);

        function animate() {
            const scrollY = lenis.scroll;
            const targetRotationY = scrollY * 0.0002;
            particles.rotation.y += (targetRotationY - particles.rotation.y) * 0.05;
            particles.rotation.x = mouse.y * 0.0001;
            particles.position.y = -scrollY / window.innerHeight * 2;
            
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        });

        // --- MAIN ANIMATIONS (Called after game) ---
        function initAnimations() {
            // Friendly Nav visibility
            ScrollTrigger.create({
                start: 'top top-=-200',
                onEnter: () => friendlyNav.classList.add('visible'),
                onLeaveBack: () => friendlyNav.classList.remove('visible')
            });

            // Section reveal animations
            gsap.utils.toArray('.reveal-up').forEach(elem => {
                gsap.fromTo(elem, { opacity: 0, y: 50 }, {
                    opacity: 1,
                    y: 0,
                    duration: 1.2,
                    ease: 'power3.out',
                    scrollTrigger: {
                        trigger: elem,
                        start: 'top 85%',
                    }
                });
            });
            // Image parallax/reveal
            gsap.utils.toArray('img').forEach(img => {
                 gsap.fromTo(img.parentElement, { scale: 1.1, clipPath: 'inset(0% 50% 0% 50%)' }, {
                     scale: 1,
                     clipPath: 'inset(0% 0% 0% 0%)',
                     duration: 1.5,
                     ease: 'power3.out',
                     scrollTrigger: {
                         trigger: img,
                         start: 'top 90%'
                     }
                 });
            });

            // Vision Counter Animation
            gsap.to("#user-counter", {
                textContent: 100000,
                duration: 3,
                ease: "power1.inOut",
                snap: { textContent: 1 },
                scrollTrigger: {
                    trigger: "#user-counter",
                    start: "top 80%",
                },
                onUpdate: function() {
                    this.targets()[0].innerHTML = Math.ceil(this.targets()[0].textContent).toLocaleString('en-US') + "+";
                }
            });

            // Nav link active state
            gsap.utils.toArray('.content-section').forEach((section) => {
                ScrollTrigger.create({
                    trigger: section,
                    start: 'top center-=100px',
                    end: 'bottom center-=100px',
                    onToggle: self => {
                        if (self.isActive) {
                            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                            document.querySelector(`.nav-link[href="#${section.id}"]`)?.classList.add('active');
                        }
                    }
                });
            });
        }
        
        // --- SMARTER MEHFOOZBOT LOGIC ---
        const chatLog = document.getElementById('chat-log');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const promptButtonsContainer = document.getElementById('prompt-buttons');

        const botResponses = {
            "greeting": "Hello, friend. It's wonderful to connect with you. How can I help you find clarity today?",
            "default": "That's a lovely question. While my abilities here are a demonstration, the full MehfoozBot can share stories and guidance on that. Every question is a step toward clarity.",
            "misinformation": "To spot misinformation, it's helpful to pause and check the source, look for evidence, and notice if the story tries to make you feel strong emotions. A calm mind is a clear mind.",
            "safety": "To stay safe online, it's wise to use strong, unique passwords and be cautious about sharing personal information. Think of your data as something precious you wouldn't leave unattended.",
            "story": "Our story began with conversations in teahouses, listening to the hopes and worries of the community. You can read more in the 'From Our Journal' section above.",
            "ulema": "We partner with trusted local Ulema (religious leaders). They act as digital literacy ambassadors, bridging traditional knowledge with modern skills to create unprecedented community acceptance."
        };
        const promptQuestions = {
            "How do you work?": "ulema",
            "What's your story?": "story",
            "How to spot fake news?": "misinformation",
            "How to stay safe?": "safety"
        };

        function getBotResponse(userInput) {
            const lowerInput = userInput.toLowerCase();
            if (lowerInput.includes('fake news') || lowerInput.includes('misinformation')) return botResponses.misinformation;
            if (lowerInput.includes('safe') || lowerInput.includes('whatsapp') || lowerInput.includes('security')) return botResponses.safety;
            if (lowerInput.includes('story') || lowerInput.includes('who are you') || lowerInput.includes('why')) return botResponses.story;
            if (lowerInput.includes('ulema') || lowerInput.includes('leaders') || lowerInput.includes('work')) return botResponses.ulema;
            if (lowerInput.includes('hello') || lowerInput.includes('hi')) return botResponses.greeting;
            return botResponses.default;
        }

        function addMessage(message, sender, isImmediate = false) {
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${sender}-bubble`;
            bubble.textContent = message;
            chatLog.appendChild(bubble);
            gsap.from(bubble, { opacity: 0, y: 20, duration: 0.5, delay: isImmediate ? 0 : 0.2 });
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        function handleUserInput(input) {
             if(input.trim()){
                addMessage(input, 'user', true);
                chatInput.value = '';
                chatInput.disabled = true;
                setTimeout(() => {
                    const response = getBotResponse(input);
                    addMessage(response, 'bot');
                    chatInput.disabled = false;
                    chatInput.focus();
                }, 1200);
             }
        }

        chatForm.addEventListener('submit', e => {
             e.preventDefault();
             handleUserInput(chatInput.value);
        });
        
        // Add prompt buttons to chat
        Object.keys(promptQuestions).forEach(question => {
            const button = document.createElement('button');
            button.className = "chat-prompt-btn text-sm rounded-full py-2 px-3";
            button.textContent = question;
            button.onclick = () => {
                handleUserInput(question);
            }
            promptButtonsContainer.appendChild(button);
        });

        addMessage(botResponses.greeting, 'bot', true);

        // --- CONTACT FORM LOGIC ---
        const contactForm = document.getElementById('contact-form');
        const formSuccess = document.getElementById('form-success');
        contactForm.addEventListener('submit', e => {
             e.preventDefault();
             gsap.to(contactForm, { opacity: 0, duration: 0.5, onComplete: () => {
                 contactForm.style.display = 'none';
                 formSuccess.classList.remove('hidden');
                 gsap.from(formSuccess, {opacity: 0, y: 20, duration: 0.5});
             }});
        });

    });
    </script>
</body>
</html>
